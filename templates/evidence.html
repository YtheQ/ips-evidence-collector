{% extends 'bootstrap/base.html' %}
{% import "bootstrap/wtf.html" as wtf %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="progress mb-4">
                <div class="progress-bar" role="progressbar" style="width: {{ progress }}%" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100">{{ form.title }}: {{ progress }}%</div>
            </div>
            <br>
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <ul class=flashes>
              {% for message in messages %}
              <li>{{ message }}</li>
              {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
            <br>

            {% if step == 1 %}
            <h3>{{ form.title }}</h3>
            <hr>
            {{ wtf.quick_form(form, form_type="horizontal") }}
            <br>
            {% endif %}

            {% if step != 1 and step != 3 %}
            <details>
            <summary>
            <h3>{{ form.title }}</h3>
            <span class="icon">ðŸ‘‡</span>
            </summary>
            {{ wtf.quick_form(form, form_type="horizontal") }}
            <br>
            </details>
            {% endif %}

            {% if step == 3 %}
            <h3>{{ form.title }}</h3>
            <form action method="post" class="form" role="form">
                {{ form.hidden_tag() }}
                {{ wtf.form_errors(form) }}
                <br/>
                {% for nested in form.dual_use_apps %}
                <details>
                    <summary>
                    <b>{{ nested.app_name.label }}</b>
                    <span class="icon">â–¼</span>
                    </summary>

                    {{ nested.hidden_tag() }}
                    <h4>{{nested.install_form.label}}</h4>
                    {{ nested.install_form }}
                    {% for perm in nested.permissions %}
                        <h4>{{ perm.permission_name.label }}</h4>
                        {{ perm.hidden_tag() }}
                        {{ perm.label }}{{ perm }}
                    {% endfor %}
                    {{nested.notes.label}}{{ nested.notes }}
                </details>
                <br>
                {% endfor %}
                {{form.submit}}
            </form>
            {% endif %}

            {% if step == 1 %}
            <p>Additional instructions here</p>
            {% endif %}
            {% if step > 1 %}
            <a href="{{ url_for('evidence', step=step-1) }}" class="btn btn-default">Previous</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
